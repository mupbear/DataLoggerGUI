{% extends "base/base.html.jinja2" %}
{% set active_page = "event" %}

{% block main %}
<button onclick="StartRetrievingData();">Start retrieving data</button>
<button onclick="StopRetrievingData();">Stop retrieving data</button>
{% endblock main %}

{% block script %}
<script>
  let keep_running = false;

  let highest_retrieved_data_id = 0;

  function StartRetrievingData()
  {    
    keep_running = true;
    RetrieveNewData();
  }

  function StopRetrievingData()
  {
    keep_running = false;
  }

  async function RetrieveNewData() 
  {
    const response = await fetch('', {
      method: "POST",
      headers: {
        "Accept": "application/json",
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        "minimum_id": 0
      }),
    });
    
    const json_data = await response.json();
    console.log(json_data);
    
    highest_retrieved_data_id += 1;
    
    if (keep_running) {
      setTimeout( RetrieveNewData, 5000 );
    }
  }
</script>
{% endblock script %}